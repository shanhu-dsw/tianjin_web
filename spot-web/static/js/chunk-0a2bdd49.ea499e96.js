(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0a2bdd49"],{1641:function(e){e.exports=JSON.parse('{"user":{"username":"supervision_271898","password":"271898","source_type":"Admin"},"delUser":["271822","271898","271809"]}')},d5a6:function(e,t,r){"use strict";r("ee3c")},ee3c:function(e,t,r){},f9f2:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-row",[r("el-col",[r("el-card",[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[r("span",{staticStyle:{"font-weight":"bold",color:"#016dbe"}},[e._v("追责问责列表")])]),r("el-form",{ref:"queryForm",attrs:{model:e.queryParams,inline:!0,"label-width":"68px"}},[r("el-row",{attrs:{type:"flex"}},[r("div",{staticClass:"numberDiv",staticStyle:{flex:"1"}},[r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新建追责问责")])],1)],1),r("div",[r("el-form-item",[e._v(" 请选择时间段： "),r("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},on:{change:e.selectTime},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}})],1)],1)])],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.dataList}},[r("el-table-column",{attrs:{label:"发生时间",align:"center",prop:"create_datetime",width:"180"}}),r("el-table-column",{attrs:{label:"问责对象",align:"center",width:"150","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s("PERSON"==t.row.type?t.row.to_real_name:t.row.to_department_name)+" ")]}}])}),r("el-table-column",{attrs:{label:"类型",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s("PERSON"==t.row.type?"个人":"单位")+" ")]}}])}),r("el-table-column",{attrs:{label:"问责类别",align:"center",prop:"accountable_type_name",width:"150","show-overflow-tooltip":!0}}),r("el-table-column",{attrs:{label:"问责详情",align:"center",prop:"content","show-overflow-tooltip":!0}}),r("el-table-column",{attrs:{label:"关联问题编号",align:"center",prop:"number",width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.problem_number?r("el-link",{on:{click:function(r){return e.handleView(t.row.problem_number)}}},[e._v("#"+e._s(t.row.problem_number))]):e._e()]}}])}),r("el-table-column",{attrs:{label:"记录单位",align:"center",prop:"from_department_name",width:"150","show-overflow-tooltip":!0}}),r("el-table-column",{attrs:{label:"记录人",align:"center",prop:"from_real_name",width:"120"}}),r("el-table-column",{attrs:{label:"操作",align:"center",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(r){return e.handleEdit(t.row)}}},[e._v("修改")]),r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(r){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),r("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList2}})],1)],1)],1),r("el-dialog",{attrs:{title:e.title,visible:e.open,width:"600px","append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.open=t}}},[r("div",{staticClass:"dialog"},[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-position":"top"}},[r("el-row",[r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"问责对象",prop:"type"}},[r("el-radio-group",{on:{change:e.changeType},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[r("el-radio",{attrs:{label:"PERSON"}},[e._v("个人")]),r("el-radio",{attrs:{label:"DEPARTMENT"}},[e._v("单位")])],1)],1)],1),r("el-col",{attrs:{span:16}},[r("el-form-item",{attrs:{prop:"to_uuid",label:" "}},["DEPARTMENT"==e.form.type?r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择单位",filterable:"",clearable:""},model:{value:e.form.to_uuid,callback:function(t){e.$set(e.form,"to_uuid",t)},expression:"form.to_uuid"}},e._l(e.departList,(function(e){return r("el-option",{key:e.uuid,attrs:{label:e.name,value:e.uuid}})})),1):e._e(),"PERSON"==e.form.type?r("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",remote:"",placeholder:"请输入姓名或警号","remote-method":e.remotePerson1,clearable:""},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.form.to_uuid,callback:function(t){e.$set(e.form,"to_uuid",t)},expression:"form.to_uuid"}},e._l(e.personList1,(function(e){return r("el-option",{key:e.uuid,attrs:{label:e.name+"-"+e.real_name,value:e.uuid}})})),1):e._e()],1)],1)],1),r("el-form-item",{attrs:{label:"问责类型",prop:"type_uuid"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择问责类型",filterable:"",clearable:""},model:{value:e.form.type_uuid,callback:function(t){e.$set(e.form,"type_uuid",t)},expression:"form.type_uuid"}},e._l(e.acctableList,(function(e){return r("el-option",{key:e.uuid,attrs:{label:e.name,value:e.uuid}})})),1)],1),r("el-form-item",{attrs:{label:"问责详情",prop:"content"}},[r("el-input",{attrs:{type:"textarea",rows:"5",placeholder:"请输入内容",maxlength:"5000","show-word-limit":""},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),r("el-form-item",{attrs:{label:"关联问题编号"}},[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:20}},[r("el-input",{attrs:{type:"number",placeholder:"请输入关联问题编号"},model:{value:e.form.problem_number,callback:function(t){e.$set(e.form,"problem_number",t)},expression:"form.problem_number"}})],1),r("el-col",{attrs:{span:4}},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleView(e.form.problem_number)}}},[e._v("查看")])],1)],1)],1),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"问责记录人"}},[r("el-input",{attrs:{disabled:""},model:{value:e.form.from_real_name,callback:function(t){e.$set(e.form,"from_real_name",t)},expression:"form.from_real_name"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"问责记录时间"}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择日期时间",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.form.create_datetime,callback:function(t){e.$set(e.form,"create_datetime",t)},expression:"form.create_datetime"}})],1)],1)],1)],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")]),r("el-button",{on:{click:function(t){e.open=!1}}},[e._v("取 消")])],1)])],1)},o=[],n=r("c7eb"),i=r("1da1"),l=r("5530"),s=(r("d81d"),r("b0c0"),r("caad"),r("2532"),r("d3b7"),r("159b"),r("14d9"),r("2f62")),u=(r("21a6"),r("c38a"),r("1641")),m=r("9d9a"),c={computed:Object(l["a"])({},Object(s["b"])(["admin"])),data:function(){return{loading:!0,queryParams:{pageNum:1,pageSize:10,offset:0,rows:10},total:0,dataList:[],dateRange:null,pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-6048e5),e.$emit("pick",[r,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-2592e6),e.$emit("pick",[r,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-7776e6),e.$emit("pick",[r,t])}}]},localJson:u,departList:[],userList:[],personList1:[],acctableList:[],title:"",open:!1,form:{},rules:{type:[{required:!0,message:"问责对象类型不能为空",trigger:"change"}],to_uuid:[{required:!0,message:"问责对象不能为空",trigger:"change"}],type_uuid:[{required:!0,message:"问责类型不能为空",trigger:"change"}],content:[{required:!0,message:"问责详情不能为空",trigger:"blur"}]}}},created:function(){this.checkRole(),this.getAccountableTypeList(),this.getDepartmentList(),this.getUserList(),this.handleQuery(),console.log(this.admin)},methods:{getAccountableTypeList:function(){var e=this;Object(m["m"])().then((function(t){console.log(t),e.acctableList=t.array}))},getDepartmentList:function(){var e=this,t={level:2};Object(m["q"])(t).then((function(t){e.departList=t.array.map((function(e){return{name:e.name,uuid:e.uuid}}))}))},getUserList:function(){var e=this,t={rows:9999,offset:0};Object(m["o"])(t).then((function(t){e.userList=t.array}))},handleQuery:function(){this.queryParams.pageNum=1,this.getList2()},getList2:function(){var e=this;this.loading=!0,this.queryParams.rows=this.queryParams.pageSize,this.queryParams.offset=(this.queryParams.pageNum-1)*this.queryParams.pageSize,this.queryParams.number||delete this.queryParams.number,this.dateRange?(this.queryParams.start_create_datetime=this.parseTime(this.dateRange[0],"{y}-{m}-{d}")+" 00:00:00",this.queryParams.end_create_datetime=this.parseTime(this.dateRange[1],"{y}-{m}-{d}")+" 23:59:59"):(delete this.queryParams.start_create_datetime,delete this.queryParams.end_create_datetime),Object(m["k"])(this.queryParams).then((function(t){e.loading=!1,e.dataList=t.array,e.total=t.count}))},checkRole:function(){u.delUser.includes(this.admin.name)&&(this.delDisabled=!1)},selectTime:function(e){this.handleQuery()},changeType:function(e){this.form.to_uuid=void 0},remotePerson1:function(e){var t=this,r=0;this.personList1=[],this.userList.forEach((function(a){(-1!=a.real_name.indexOf(e)&&r<=20||-1!=a.name.indexOf(e)&&r<=20)&&(t.personList1.push(a),r++)}))},handleAdd:function(){this.reset(),this.open=!0,this.title="新建问责记录"},handleEdit:function(e){var t=this;this.reset();var r=Object(l["a"])({},e);this.form={uuid:r.uuid,type:r.type,to_uuid:r.to_uuid,problem_number:r.problem_number,type_uuid:r.type_uuid,content:r.content,to_lv2_department_uuid:r.to_lv2_department_uuid,create_datetime:r.create_datetime,from_uuid:r.from_uuid,from_lv2_department_uuid:r.from_department_uuid,from_real_name:r.from_real_name},"PERSON"==this.form.type&&(this.personList1=[],this.userList.forEach((function(e){e.uuid==t.form.to_uuid&&t.personList1.push(e)}))),this.open=!0,this.title="修改问责记录"},submitForm:function(){var e=this;return Object(i["a"])(Object(n["a"])().mark((function t(){return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.setToLV2();case 2:e.$refs["form"].validate((function(t){t&&(void 0!=e.form.uuid?(e.form.problem_number||(e.form.problem_number="null"),Object(m["F"])(e.form).then((function(t){e.$modal.msgSuccess("修改成功"),e.open=!1,e.getList2()}))):Object(m["a"])(e.form).then((function(t){e.$modal.msgSuccess("新增成功"),e.open=!1,e.getList2()})))}));case 3:case"end":return t.stop()}}),t)})))()},reset:function(){this.form={type:"PERSON",to_uuid:void 0,problem_number:void 0,from_uuid:this.admin.uuid,type_uuid:void 0,content:void 0,from_lv2_department_uuid:this.admin.department_uuid2,to_lv2_department_uuid:this.admin.department_uuid2,create_datetime:this.parseTime(new Date),from_real_name:this.admin.real_name},this.resetForm("form")},setToLV2:function(){var e=this;return new Promise((function(t){if(!e.form.to_uuid)return t("nextt");if("PERSON"!=e.form.type)return"DEPARTMENT"==e.form.type?(e.form.to_lv2_department_uuid=e.form.to_uuid,t("nextt")):t("nextt");var r={uuid:e.form.to_uuid,offset:0,rows:10};Object(m["n"])(r).then((function(r){var a=r.array[0].department_uuid;switch(r.array[0].parent_array.length){case 2:a=r.array[0].parent_array[1].uuid;break}return e.form.to_lv2_department_uuid=a,console.log(e.form),t("nextt")}))}))},handleView:function(e){if(e){var t=this.$router.resolve({name:"view",query:{number:e,operate:"view"}});window.open(t.href,"_blank")}},handleDelete:function(e){var t=this;this.$modal.confirm("是否确认删除该数据").then((function(){return Object(m["h"])({uuid:e.uuid})})).then((function(){t.handleQuery(),t.$modal.msgSuccess("删除成功")})).catch((function(){}))}}},d=c,p=(r("d5a6"),r("2877")),f=Object(p["a"])(d,a,o,!1,null,null,null);t["default"]=f.exports}}]);