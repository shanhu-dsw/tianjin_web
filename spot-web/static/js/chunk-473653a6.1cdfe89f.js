(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-473653a6"],{1641:function(e){e.exports=JSON.parse('{"user":{"username":"supervision_271898","password":"271898","source_type":"Admin"},"delUser":["271822","271898","271809"]}')},"2c33":function(e,t,a){"use strict";a("de98")},"9db8":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-row",[a("el-col",[a("el-card",[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{"font-weight":"bold",color:"#016dbe"}},[e._v("问题列表")])]),a("el-form",{ref:"queryForm",attrs:{model:e.queryParams,inline:!0,"label-width":"68px"}},[a("el-row",{attrs:{type:"flex"}},[a("div",{staticClass:"numberDiv",staticStyle:{flex:"1"}},[a("el-form-item",[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"输入问题编号","prefix-icon":"el-icon-search"},model:{value:e.queryParams.number,callback:function(t){e.$set(e.queryParams,"number",t)},expression:"queryParams.number"}},[a("el-button",{attrs:{slot:"append"},on:{click:e.handleQuery},slot:"append"},[e._v("搜索")])],1)],1)],1),a("div",[a("el-form-item",[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},on:{change:e.selectTime},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}})],1)],1),a("el-form-item",[a("el-button",{attrs:{type:"warning",plain:"",icon:"el-icon-download"},on:{click:e.handleExport}},[e._v("导出")])],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.dataList},on:{"filter-change":e.filterChange}},[a("el-table-column",{attrs:{label:"问题编号",align:"center",prop:"number",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" #"+e._s(t.row.number)+" ")]}}])}),a("el-table-column",{attrs:{label:"问题状态",align:"center",prop:"status",width:"120","column-key":"status","filter-multiple":!1,filters:e.statusList,"filter-placement":"bottom"},scopedSlots:e._u([{key:"default",fn:function(t){return["UN_FEEDBACK"==t.row.status?a("el-tag",{attrs:{type:"warning",effect:"dark"}},[e._v("未反馈")]):e._e(),"FEEDBACK"==t.row.status?a("el-tag",{attrs:{type:"success",effect:"dark"}},[e._v("已反馈")]):e._e(),"FILED"==t.row.status?a("el-tag",{attrs:{type:"info",effect:"dark"}},[e._v("已归档")]):e._e()]}}])}),a("el-table-column",{attrs:{label:"检查单位",align:"center",prop:"from_department_name","column-key":"from_department_uuid","filter-multiple":!1,filters:e.fromDeptList,"filter-placement":"bottom"}}),a("el-table-column",{attrs:{label:"问题类型",align:"center",prop:"problem_department_type_parent_name",width:"140","column-key":"problem_type","filter-multiple":!1,filters:e.typeList,"filter-placement":"bottom"}}),a("el-table-column",{attrs:{label:"问题类别",align:"center",prop:"problem_department_type_name","show-overflow-tooltip":!0,"column-key":"type_uuids",filters:e.problemTypeList,"filter-placement":"bottom"}}),a("el-table-column",{attrs:{label:"发生时间",align:"center",prop:"create_datetime",width:"180"}}),a("el-table-column",{attrs:{label:"问题单位",align:"center",prop:"department_name","show-overflow-tooltip":!0,"column-key":"to_department_uuid","filter-multiple":!1,filters:e.toDeptList,"filter-placement":"bottom"}}),a("el-table-column",{attrs:{label:"责任人",align:"center",width:"120",prop:"responsible_real_name","show-overflow-tooltip":!0,"column-key":"responsible","filter-multiple":!1,filters:e.responsibleList,"filter-placement":"bottom"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.responsible_real_name&&t.row.responsible_real_name.length>0?t.row.responsible_real_name.join(","):"")+" ")]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return e.handleView(t.row)}}},[e._v("查看")]),e.delDisabled?e._e():a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList2}})],1)],1)],1)],1)},i=[],n=a("2909"),s=a("5530"),l=(a("e9c4"),a("a15b"),a("d81d"),a("b0c0"),a("4de4"),a("d3b7"),a("caad"),a("2532"),a("14d9"),a("81b2"),a("0eb6"),a("b7ef"),a("8bd4"),a("ace4"),a("5cc6"),a("907a"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("986a"),a("1d02"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("1b3b"),a("3d71"),a("c6e3"),a("ac1f"),a("5319"),a("fb6a"),a("2f62")),o=a("21a6"),u=a("c38a"),c=a("1641"),m=a("9d9a"),d={computed:Object(s["a"])({},Object(l["b"])(["admin"])),data:function(){return{loading:!0,queryParams:{pageNum:1,pageSize:10,offset:0,rows:10},total:0,dataList:[],delDisabled:!0,dateRange:null,pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]},statusList:[{text:"未反馈",value:"UN_FEEDBACK"},{text:"反馈属实",value:"FACT"},{text:"反馈不属实",value:"NOT_FACT"},{text:"已归档",value:"FILED"}],typeList:[{text:"自查",value:"SELF"},{text:"检查",value:"CHECK"}],responsibleList:[{text:"有责任人",value:"true"},{text:"无责任人",value:"false"}],fromDeptList:[],toDeptList:[],problemTypeList:[],localJson:c}},watch:{$route:{immediate:!0,handler:function(){this.queryParams.status=this.$route.query.status,console.log(this.queryParams.status),this.handleQuery()}}},created:function(){this.checkRole(),this.getDepartmentList(),this.getProblemDepartmentTypeList()},methods:{filterChange:function(e){var t=JSON.stringify(e),a=JSON.parse(t);a.status&&("FACT"==a.status||"NOT_FACT"==a.status?(this.queryParams.status="FEEDBACK",this.queryParams.fact=a.status[0]):(this.queryParams.status=a.status[0],delete this.queryParams.fact)),a.problem_type&&(this.queryParams.problem_type=a.problem_type[0]),a.from_department_uuid&&(this.queryParams.from_department_uuid=a.from_department_uuid[0]),a.to_department_uuid&&(this.queryParams.to_department_uuid=a.to_department_uuid[0]),a.type_uuids&&(0==a.type_uuids.length?delete this.queryParams.type_uuids:this.queryParams.type_uuids=a.type_uuids.join(";")),a.responsible&&(this.queryParams.responsible_uuid_has=a.responsible[0]),this.handleQuery()},getDepartmentList:function(){var e=this,t={level:2};Object(m["q"])(t).then((function(t){e.toDeptList=t.array.map((function(e){return{text:e.name,value:e.uuid}})),e.fromDeptList=Object(n["a"])(e.toDeptList)}))},getProblemDepartmentTypeList:function(){var e=this;Object(m["A"])().then((function(t){var a=t.array.filter((function(e){return 2==e.level}));e.problemTypeList=a.map((function(e){return{text:e.name,value:e.uuid}}))}))},handleQuery:function(){this.queryParams.pageNum=1,this.getList2()},getList2:function(){var e=this;console.log(this.queryParams),this.loading=!0,this.queryParams.rows=this.queryParams.pageSize,this.queryParams.offset=(this.queryParams.pageNum-1)*this.queryParams.pageSize,this.queryParams.number||delete this.queryParams.number,this.dateRange?(this.queryParams.start_create_datetime=this.parseTime(this.dateRange[0],"{y}-{m}-{d}")+" 00:00:00",this.queryParams.end_create_datetime=this.parseTime(this.dateRange[1],"{y}-{m}-{d}")+" 23:59:59"):(delete this.queryParams.start_create_datetime,delete this.queryParams.end_create_datetime),this.queryParams=Object(u["c"])(this.admin,this.queryParams,!0),Object(m["C"])(this.queryParams).then((function(t){e.loading=!1,e.dataList=t.array,e.total=t.count}))},checkRole:function(){c.delUser.includes(this.admin.name)&&(this.delDisabled=!1)},selectTime:function(e){this.handleQuery()},handleView:function(e){this.$router.push({path:"/problem/view",query:{number:e.number,operate:"view"}})},handleEdit:function(e){this.$router.push({path:"/problem/view",query:{number:e.number,operate:"edit"}})},handleDelete:function(e){var t=this;this.$modal.confirm('是否确认删除编号为"'+e.number+'"的问题数据').then((function(){return Object(m["i"])({uuid:e.uuid})})).then((function(){t.handleQuery(),t.$modal.msgSuccess("删除成功")})).catch((function(){}))},handleExport:function(){var e=this;this.loading=!0,this.queryParams.number||delete this.queryParams.number,this.dateRange?(this.queryParams.start_create_datetime=this.parseTime(this.dateRange[0],"{y}-{m}-{d}")+" 00:00:00",this.queryParams.end_create_datetime=this.parseTime(this.dateRange[1],"{y}-{m}-{d}")+" 23:59:59"):(delete this.queryParams.start_create_datetime,delete this.queryParams.end_create_datetime),this.queryParams=Object(u["c"])(this.admin,this.queryParams,!0);var t=Object(s["a"])({},this.queryParams);t.rows=99999,t.offset=0,Object(m["D"])(t).then((function(t){var a=function(e){for(var t=atob(e),a=new Uint8Array(t.length),r=0;r<t.length;r++)a[r]=t.charCodeAt(r);var i=new TextDecoder("utf-8");return i.decode(a)},r=a(t),i=r.replace(/&nbsp;/g,""),n=e.stringToBase64(i),s=e.b64toFile(n,"问题列表","application/vnd.ms-excel;charset=utf-8");Object(o["saveAs"])(s,"问题列表.csv"),e.loading=!1}))},stringToBase64:function(e){var t=new TextEncoder,a=t.encode(e),r=this.base64ArrayBuffer(a);return r},base64ArrayBuffer:function(e){for(var t,a,r,i,n,s="",l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=new Uint8Array(e),u=o.byteLength,c=u%3,m=u-c,d=0;d<m;d+=3)n=o[d]<<16|o[d+1]<<8|o[d+2],t=(16515072&n)>>18,a=(258048&n)>>12,r=(4032&n)>>6,i=63&n,s+=l[t]+l[a]+l[r]+l[i];return 1===c?(n=o[m],t=(252&n)>>2,a=(3&n)<<4,s+=l[t]+l[a]+"=="):2===c&&(n=o[m]<<8|o[m+1],t=(64512&n)>>10,a=(1008&n)>>4,r=(15&n)<<2,s+=l[t]+l[a]+l[r]+"="),s},b64toFile:function(e,t,a){for(var r=512,i=atob(e),n=[],s=0;s<i.length;s+=r){for(var l=i.slice(s,s+r),o=new Array(l.length),u=0;u<l.length;u++)o[u]=l.charCodeAt(u);var c=new Uint8Array(o);n.push(c)}var m=new File(n,t,{type:a});return m}}},p=d,h=(a("2c33"),a("2877")),f=Object(h["a"])(p,r,i,!1,null,null,null);t["default"]=f.exports},de98:function(e,t,a){}}]);