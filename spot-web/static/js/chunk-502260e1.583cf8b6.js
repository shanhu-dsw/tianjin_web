(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-502260e1"],{"27b0":function(t,e,a){"use strict";a("fdbd")},b722:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("el-row",[a("el-col",[a("el-card",[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{"font-weight":"bold"}},[t._v("消息列表（未读"+t._s(t.total2)+"条，总共"+t._s(t.total)+"条）")]),a("div",{staticClass:"pull-right"},[a("el-button",{attrs:{type:"primary"},on:{click:t.openDialog}},[t._v("发送信息给管理员")])],1)]),a("ul",{staticClass:"list-group",staticStyle:{margin:"0"}},t._l(t.dataList,(function(e,i){return a("li",{key:i,staticClass:"list-group-item",on:{click:function(a){return t.readMsg(e,!1)}}},[a("div",["UN_READ"==e.is_read?a("svg-icon",{staticStyle:{"font-size":"20px","margin-right":"5px"},attrs:{"icon-class":"message-no"}}):t._e(),"READ"==e.is_read?a("svg-icon",{staticStyle:{"font-size":"20px","margin-right":"5px"},attrs:{"icon-class":"message-yes"}}):t._e(),a("span",{style:{color:"UN_READ"==e.is_read?"#0b615a":"#000"}},[t._v(t._s(e.title))])],1),a("div",{style:{"margin-top":"10px",height:"60px",color:"UN_READ"==e.is_read?"#0b615a":"#000"}},[t._v(" "+t._s(e.content)+" ")]),a("div",{staticStyle:{display:"flex","align-items":"center"}},[a("div",{staticStyle:{width:"300px"}},[a("svg-icon",{attrs:{"icon-class":"user"}}),t._v(" "+t._s(t.getUser(e))+" ")],1),a("svg-icon",{staticStyle:{"margin-right":"5px"},attrs:{"icon-class":"time"}}),t._v(" "+t._s(e.create_datetime)+" "),a("div",{staticStyle:{flex:"1","text-align":"right"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.remark,expression:"item.remark"}],attrs:{icon:"el-icon-right",size:"small",type:"success"},on:{click:function(a){return t.readMsg(e,!0)}}},[t._v("跳转问题详情")])],1)],1)])})),0),a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total > 0"}],attrs:{total:t.total,page:t.queryParams.pageNum,limit:t.queryParams.pageSize},on:{"update:page":function(e){return t.$set(t.queryParams,"pageNum",e)},"update:limit":function(e){return t.$set(t.queryParams,"pageSize",e)},pagination:t.getList}})],1)],1)],1),a("el-dialog",{attrs:{title:"发送消息给管理员",visible:t.open,width:"800px","append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(e){t.open=e}}},[a("el-form",{ref:"form",attrs:{"label-position":"top",model:t.form,rules:t.rules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"To"}},[a("el-input",{attrs:{placeholder:"",disabled:""},model:{value:t.to,callback:function(e){t.to=e},expression:"to"}})],1),a("el-form-item",{attrs:{label:"消息内容",prop:"content"}},[a("el-input",{attrs:{type:"textarea",rows:"5",placeholder:"请输入内容",maxlength:"5000","show-word-limit":""},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:t.submitForm}},[t._v("确 定")]),a("el-button",{on:{click:function(e){t.open=!1}}},[t._v("取 消")])],1)],1)],1)},r=[],n=a("c7eb"),s=a("1da1"),o=a("5530"),u=(a("4de4"),a("d3b7"),a("b0c0"),a("14d9"),a("2f62")),c=a("c38a"),l=a("9d9a"),d={computed:Object(o["a"])({},Object(u["b"])(["admin"])),data:function(){return{loading:!0,queryParams:{pageNum:1,pageSize:10,offset:0,rows:10},total:0,total2:0,dataList:[],open:!1,form:{content:""},to:"系统管理员",rules:{content:[{required:!0,message:"消息内容不能为空",trigger:"change"}]},userList:[]}},created:function(){this.getUserList(),this.getList()},methods:{getUserList:function(){var t=this,e={rows:9999,offset:0};Object(l["n"])(e).then((function(e){t.userList=e.array.filter((function(t){return"superadmin"==t.role_name})),console.log(t.userList)}))},getList:function(){var t=this;this.loading=!0;var e={rows:this.queryParams.pageSize,offset:(this.queryParams.pageNum-1)*this.queryParams.pageSize,to_uuid:this.admin.uuid};Object(l["v"])(e).then((function(e){t.dataList=e.array,t.total=e.count;var a={rows:1,offset:0,to_uuid:t.admin.uuid,read:"UN_READ"};Object(l["v"])(a).then((function(e){t.loading=!1,t.total2=e.count}))}))},getUser:function(t){return t.from_uuid_info?t.from_uuid_info.real_name+"-"+t.from_uuid_info.name:"系统自动发送"},readMsg:function(t,e){var a=this;if("UN_READ"==t.is_read){var i={uuid:t.uuid,read:"READ"};Object(l["I"])(i).then((function(i){t.is_read="READ",a.total2--;var r={rows:1,offset:0,to_uuid:a.admin.uuid,read:"UN_READ"};a.$store.dispatch("GetNoRead",r).then((function(i){t.remark&&e&&a.handleQuery(t.remark)}))}))}else t.remark&&e&&this.handleQuery(t.remark)},handleQuery:function(t){var e=this,a={uuid:t,offset:0,rows:1};a=Object(c["c"])(this.admin,a,!1),Object(l["C"])(a).then((function(t){1==t.count?e.$router.push({path:"/problem/view",query:{number:t.array[0].number}}):e.$modal.notifyError("抱歉，无权限查看问题！")}))},openDialog:function(){this.form.content="",this.resetForm("form"),this.open=!0},submitForm:function(){var t=this;return Object(s["a"])(Object(n["a"])().mark((function e(){var a,i,r;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=!1,t.$refs["form"].validate((function(t){a=t})),a){e.next=4;break}return e.abrupt("return");case 4:i=0;case 5:if(!(i<t.userList.length)){e.next=11;break}return e.next=8,t.sendMsg(t.userList[i].uuid);case 8:i++,e.next=5;break;case 11:r={offset:0,rows:1,read:"UN_READ",to_uuid:t.admin.uuid},t.$store.dispatch("GetNoRead",r),t.getList(),t.open=!1;case 15:case"end":return e.stop()}}),e)})))()},sendMsg:function(t){var e=this;return new Promise((function(a){var i={from_uuid:e.admin.uuid,to_uuid:t,title:e.admin.real_name+"("+e.admin.name+")提交问题",content:e.form.content};Object(l["d"])(i).then((function(t){return a("next")}))}))}}},m=d,f=(a("27b0"),a("2877")),p=Object(f["a"])(m,i,r,!1,null,null,null);e["default"]=p.exports},fdbd:function(t,e,a){}}]);